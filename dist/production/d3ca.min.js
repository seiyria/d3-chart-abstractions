var Merge=function(){var a=this;return a.CopyLeft=function(b,c){var d=JSON.parse(JSON.stringify(b));for(var e in b)c.hasOwnProperty(e)&&(d[e]="object"==typeof b[e]?a.CopyLeft(b[e],c[e]):c[e]);return d},a.BarMerge=function(b,c){var d=a.CopyLeft(b,c);d.layout.width=d.layout.width-d.layout.margin.left-d.layout.margin.right,d.layout.height=d.layout.height-d.layout.margin.top-d.layout.margin.bottom;var e=[d.display.labels.aggregate,d.display.labels.tooltip,d.display.labels.legend,d.display.labels.axes,d.display.labels.bars,d.display.labels.x,d.display.labels.y];d.display.labels.tooltip.formatting=d.display.labels.tooltip.formatting||d.display.labels.bars.formatting,e.forEach(function(a){a.formatting=a.formatting||d.formatting,"function"!=typeof a.formatting.numFormat&&(a.formatting.numFormat=d3.format(a.formatting.numFormat))});var f=[d.display.labels.aggregate,d.display.labels.tooltip,d.display.labels.legend,d.display.labels.axes,d.display.labels.bars,d.display.labels.x,d.display.labels.y];return f.forEach(function(a){a.font=a.font||d.font}),d},this}(),BarGraph=function(a){var b=Merge.BarMerge(this.defaults,a);this.layout=b.layout,this.data=b.data,this.display=b.display;var c,d,e,f,g,h=this.data.graph[0].data.length,i=Object.keys(this.data.graph).length,j=this,k=function(){"group"==j.layout.graph.style?j.stackTransition(!1):j.groupTransition(!1)},l=function(){var a=[];for(var b in j.data.graph){var c=j.data.graph[b];c.total=0;for(var d in c.data){var e=c.data[d];c.total+=e.value}a.push({name:c.name,value:c.total})}return a}(),m=function(a){var b=[],c=[];for(var d in j.data.graph){var e=j.data.graph[d];b=b.concat(e.data[a]),c.push(e)}var f=function(a){return a.hidden?!1:0===j.display.labels.bars.hideThreshold?!0:a.value>j.display.labels.bars.hideThreshold},g=b.map(function(a,b){var d=function(a){return"percent"===j.layout.graph.type?Math.max(0,100*(a.value/c[b].total)):a.value},e=d(a);return{id:a.name+j.currentItem++,name:a.name,parent:c[b].name,dispValue:f(e)?e:0,x:b,y:f(a)?"percent"==j.layout.graph.type?Math.max(0,100*(a.value/c[b].total)):a.value:0}});return g},n=function(){if(c)return c;var a=[];return j.display.labels.aggregate.show&&(a=l.map(function(a,b){return{id:"agg"+j.currentItem++,isAggregate:!0,name:a.name,dispValue:a.value,x:b,y:a.value,y0:a.value}})),c=a,a},o=d3.layout.stack(),p=d3.range(h).map(function(a,b){return m(b)}),q=o(p),r=d3.max(q,function(a){return d3.max(a,function(a){return a.y})}),s=d3.max(q,function(a){return d3.max(a,function(a){return a.y0+a.y})});"value"==j.layout.graph.type&&(s+=Math.floor(s/10));var t,u,v,w,x=d3.tip().attr("class","d3-tip").html(function(a){return j.display.labels.tooltip.formatting.strFormat.split("%n").join(j.display.labels.tooltip.formatting.numFormat(a.dispValue))});x.offset([-5,0]);var y=function(){var a={x:function(a,b,c){var d=f(a.x);return"stack"==j.layout.graph.style?d+=(j.layout.graph.bars.maxWidth?j.layout.graph.bars.maxWidth:f.rangeBand())/2:(d+=j.layout.graph.bars.spacing/4,d+=f.rangeBand()/h*c,d+=(j.layout.graph.bars.maxWidth?j.layout.graph.bars.maxWidth:f.rangeBand()/h)/2),d-a.compLen/2},y:function(a){var b=a.compHeight/3;return b+="stack"==j.layout.graph.style?a.isAggregate?g(a.y0):g(a.y0+a.y/2):g(a.y/2)},height:function(a){return"stack"==j.layout.graph.style?g(a.y0)-g(a.y0+a.y):j.layout.height-g(a.y)},width:function(){return"stack"==j.layout.graph.style?f.rangeBand():(j.layout.graph.bars.maxWidth?j.layout.graph.bars.maxWidth:f.rangeBand()/h)/2}},b={x:function(b,c,d){var e=a.x(b,c,d);return e-="stack"==j.layout.graph.style?(j.layout.graph.bars.maxWidth?j.layout.graph.bars.maxWidth:f.rangeBand())/2:(j.layout.graph.bars.maxWidth?j.layout.graph.bars.maxWidth:f.rangeBand()/h)/2,e+=b.compLen/2},y:function(b){return a.y(b)},height:function(b){return a.height(b)},width:function(b){return a.width(b)}},c={x:function(b,c,d){var e=a.x(b,c,d);return e+="stack"==j.layout.graph.style?(j.layout.graph.bars.maxWidth?j.layout.graph.bars.maxWidth:f.rangeBand())/2:(j.layout.graph.bars.maxWidth?j.layout.graph.bars.maxWidth:f.rangeBand()/h)/2,e-=b.compLen/2},y:function(b){return a.y(b)},height:function(b){return a.height(b)},width:function(b){return a.width(b)}},d={x:function(b,c,d){return a.x(b,c,d)},y:function(a){var b=0;return b+="stack"==j.layout.graph.style?g(a.y0+a.y):g(a.y),b+=a.compHeight},height:function(b){return a.height(b)},width:function(b){return a.width(b)}},e={x:function(b,c,d){return a.x(b,c,d)},y:function(a){var b=0;return b+="stack"==j.layout.graph.style?g(a.y0):g(0),b-=a.compHeight/4},height:function(b){return a.height(b)},width:function(b){return a.width(b)}};switch(j.display.labels.bars.font.align){case"center":return a;case"left":return b;case"right":return c;case"top":return d;case"bottom":return e;default:console.error("invalid formatting.bars.textalign "+j.display.labels.bars.font.align)}};j.redraw=function(){var a=function(){switch(j.layout.legend.compass){case"left":return{x:-j.layout.width-j.layout.padding-j.layout.margin.left,y:j.layout.height/2-j.layout.legend.height/2,offsetX:j.layout.legend.width,offsetY:0};case"right":return{x:-j.layout.margin.right,y:j.layout.height/2-j.layout.legend.height/2,offsetX:0,offsetY:0};case"bottom":return{x:j.layout.width/2-j.layout.legend.width/2,y:j.layout.margin.bottom/2+j.layout.legend.height/2,offsetX:0,offsetY:0};case"top":return{x:j.layout.width/2-j.layout.legend.width/2,y:-j.layout.height-j.layout.legend.height/2,offsetX:0,offsetY:0};default:console.error("invalid legend position "+j.layout.legend.compass)}},b=function(){var a={width:j.layout.width+j.layout.margin.left+j.layout.margin.right,height:j.layout.height+j.layout.margin.top+j.layout.margin.bottom+j.layout.padding,offsetX:j.layout.margin.left,offsetY:j.layout.margin.top};switch(j.layout.legend.compass){case"left":a.offsetX+=j.layout.legend.width;break;case"bottom":a.offsetY+=j.layout.legend.height/2}return a};f=d3.scale.ordinal().domain(d3.range(i)).rangeRoundBands([0,j.layout.width],.08),g=d3.scale.linear().domain([0,s]).range([j.layout.height,0]),d=d3.svg.axis().scale(f).tickSize(0).tickPadding(j.display.grid.tickPadding).orient("bottom"),e=d3.svg.axis().scale(g).orient("left").tickSize(-1!==j.display.grid.lines.indexOf("horiz")?-j.layout.width:0,0,0).tickPadding(j.display.grid.tickPadding).ticks(j.display.grid.tickCount);var c=function(){var a=b();return w&&d3.select("svg").remove(),w=d3.select(j.display.target).append("svg").attr("width",a.width).attr("height",a.height).attr("class","graph-vertical").append("g").attr("transform","translate("+a.offsetX+","+a.offsetY+")"),w.append("g").attr("class","grid").call(e),w.append("g").attr("class","y axis").attr("stroke-width","0").attr("transform","translate(20,0)").call(e),w.append("g").attr("class","x axis").attr("transform","translate(0,"+j.layout.height+")").call(d),w.append("g").attr("class","legend container").append("rect").attr("class","x label legend").style("fill","#cac").style("stroke","#000").style("stroke-width","1px").attr("x",j.layout.width/2).attr("y",j.layout.height+j.layout.padding).call(d),w.append("text").attr("class","y label").attr("text-anchor","end").attr("y",-20).attr("x",-j.layout.height/2).attr("dy",".75em").attr("transform","rotate(-90)").style("font-family",j.display.labels.y.font.face).style("font-size",j.display.labels.y.font.size).style("font-weight",j.display.labels.y.font.weight).style("font-style",j.display.labels.y.font.style).text(j.display.labels.y.text),w.append("text").attr("class","x label").attr("text-anchor","end").attr("x",j.layout.width/2).attr("y",j.layout.height+20).attr("dy",".75em").style("font-family",j.display.labels.x.font.face).style("font-size",j.display.labels.x.font.size).style("font-weight",j.display.labels.x.font.weight).style("font-style",j.display.labels.x.font.style).text(j.display.labels.x.text),w.append("foreignObject").attr("width",32).attr("height",32).attr("x",j.layout.width-j.layout.padding).attr("y",0).attr("class","swap-icon").on("mousedown",k).append("xhtml:body").html("<i class='fa fa-tasks'></i>"),w.call(x),w}();!function(){var a=c.append("svg:defs");for(var b in j.data.legend){var d=j.data.legend[b],e=a.append("svg:linearGradient").attr("id","gradient-"+d.name).attr("x1","50%").attr("y1","0%").attr("x2","50%").attr("y2","100%");e.append("svg:stop").attr("offset","1%").attr("stop-color","#fff"),e.append("svg:stop").attr("offset","100%").attr("stop-color",d.color)}}();var h=c.selectAll(".layer").data(q).enter().append("g").attr("class","layer").style("fill",function(a,b){return j.isGradient?"url(#gradient-"+j.data.legend[b].name+")":j.data.legend[b].color}),l=h.selectAll("rect").data(function(a){return a});t=function(){return l.enter().append("rect").attr("class","bar").on("mouseover",x.show).on("mouseout",x.hide).on("mousedown",function(a){console.debug(a.parent+" "+a.dispValue)}).style("stroke","#000").style("stroke-width","1px")}(),u=function(){var a=l.enter().append("text").text(function(a){return 0!==a.dispValue&&j.display.labels.bars.show?j.display.labels.bars.formatting.strFormat.split("%n").join(j.display.labels.bars.formatting.numFormat(a.dispValue)):""}).attr("width",j.layout.graph.bars.maxWidth?j.layout.graph.bars.maxWidth:f.rangeBand()).attr("class",function(a){return"rectInner "+a.id}).style("pointer-events","none").style("font-family",j.display.labels.bars.font.face).style("font-size",j.display.labels.bars.font.size).style("font-weight",j.display.labels.bars.font.weight).style("font-style",j.display.labels.bars.font.style).style("fill","#000");return a.each(function(){var a=d3.select(this),b=this.getBBox().width,c=this.getBBox().height;a.attr("x",function(d){return d.compLen=b,d.compHeight=c,a.attr("x")})}),a}(),j.display.labels.aggregate.show&&(v=function(){var a=n();d3.range(i).map(function(b,c){w.append("text").text(a[c].dispValue).attr("class","rectInner aggregate").style("font-family",j.display.labels.bars.font.face).style("font-size",j.display.labels.bars.font.size).style("font-weight",j.display.labels.bars.font.weight).style("font-style",j.display.labels.bars.font.style).style("fill","#000")});var b=w.selectAll(".aggregate");return b.each(function(b,c){d3.select(this);var d=this.getBBox().width,e=this.getBBox().height;a[c].compLen=d,a[c].compHeight=e}),b}()),!function(){var b=function(a){var b=a?13:0;switch(j.layout.legend.compass){case"right":return function(){return j.layout.width+j.layout.margin.right+b};case"left":return function(){return j.layout.width+j.layout.margin.left+b};case"bottom":case"top":return function(a,c){return 30*c+b}}},d=function(a){var b=a?8:0;switch(j.layout.legend.compass){case"right":case"left":return function(a,c){return 20*c+b};case"bottom":case"top":return function(){return j.layout.height+b}}},e=c.append("g").attr("class","legend").attr("height",j.layout.legend.height).attr("width",j.layout.legend.width);e.selectAll("rect").data(j.data.legend).enter().append("rect").attr("x",b()).attr("y",d()).attr("width",10).attr("height",10).on("mousedown",function(a){console.debug(a)}).style("fill",function(a){return a.color}),e.selectAll("text").data(j.data.legend).enter().append("text").attr("x",b(!0)).attr("y",d(!0)).style("font-family",j.display.labels.legend.font.face).style("font-size",j.display.labels.legend.font.size).style("font-weight",j.display.labels.legend.font.weight).style("font-style",j.display.labels.legend.font.style).text(function(a){return a.name});var f=0,g=0;e.each(function(){f++;var a=this.getBBox().width;a>g&&(g=a);var b=d3.select(this);b.attr("x",parseInt(b.attr("x"))+10)}),j.layout.legend.width=g*f;var h=a();return e.attr("transform","translate("+(h.x-h.offsetX)+","+(h.y-h.offsetY)+")"),e}()};var z=function(){w.selectAll(".x.axis .tick text").text(function(a){return j.data.graph[a].name}),w.selectAll(".axis .tick text").style("font-family",j.display.labels.bars.font.face).style("font-size",j.display.labels.bars.font.size).style("font-weight",j.display.labels.bars.font.weight).style("font-style",j.display.labels.bars.font.style),w.selectAll(".grid .tick text").style("display","none"),w.selectAll(".label").each(function(){var a=d3.select(this);if("true"!==a.attr("data-centered")){var b=this.getBBox().width,c=parseInt(a.attr("x"))+b/2;a.attr("x",c),a.attr("data-centered","true")}})};j.groupTransition=function(a){j.layout.graph.style="group";var b=y(),c=2.5*r;"percent"==j.layout.type&&(c*=2/3),g.domain([0,c]),t.transition().duration(a?0:500).delay(function(b,c){return a?0:10*c}).attr("x",function(a,b,c){return f(a.x)+j.layout.graph.bars.spacing/2+f.rangeBand()/h*c}).attr("width",(j.layout.graph.bars.maxWidth?j.layout.graph.bars.maxWidth:f.rangeBand()/h)-j.layout.graph.bars.spacing/2).transition().duration(a?0:250).attr("y",function(a){return g(a.y)}).attr("height",function(a){return j.layout.height-g(a.y)}),u.transition().duration(a?0:500).delay(function(b,c){return a?0:10*c}).attr("x",b.x).attr("width",b.width).transition().duration(a?0:250).attr("y",b.y).attr("height",b.height).each("end",function(a){var b=d3.select(this),c=w.select("."+a.id),d=b.attr("height");j.display.labels.bars.hideSmallValueLabels&&d<=a.compHeight?c.style("visibility","hidden"):c.style("visibility","visible")}),j.display.labels.aggregate.show&&v.transition().duration(a?0:500).delay(function(b,c){return a?0:10*c}).attr("opacity",0),z()},j.stackTransition=function(a){j.layout.graph.style="stack";var b=y();if(g.domain([0,s]),t.transition().duration(a?0:500).delay(function(b,c){return a?0:10*c}).attr("y",function(a){return g(a.y0+a.y)}).attr("height",function(a){return g(a.y0)-g(a.y0+a.y)}).transition().duration(a?0:250).attr("x",function(a){return f(a.x)}).attr("width",j.layout.graph.bars.maxWidth?j.layout.graph.bars.maxWidth:f.rangeBand()),u.transition().duration(a?0:500).delay(function(b,c){return a?0:10*c}).attr("y",b.y).attr("height",b.height).transition().duration(a?0:250).attr("x",b.x).attr("width",b.width).each("end",function(a){var b=d3.select(this),c=w.select("."+a.id),d=b.attr("height");j.display.labels.bars.hideSmallValueLabels&&d<=a.compHeight?c.style("visibility","hidden"):c.style("visibility","visible")}),j.display.labels.aggregate.show){var c=n();v.transition().duration(a?0:500).delay(function(b,c){return a?0:10*c}).attr("opacity",1).attr("y",function(a,d,e){return b.y(c[d],d,e)-c[d].compHeight/2}).attr("height",function(a,d,e){return b.height(c[d],d,e)}).transition().duration(a?0:250).attr("x",function(a,d,e){return b.x(c[d],d,e)}).attr("width",function(a,d,e){return b.width(c[d],d,e)})}z()},j.redraw(),function(){switch(j.layout.graph.style){case"group":return j.groupTransition(!0),void 0;case"stack":return j.stackTransition(!0),void 0;default:console.error("invalid layout style "+j.layout.graph.style)}}()};BarGraph.prototype.defaults={formatting:{numFormat:"",strFormat:"%n",formatter:function(a){return a}},font:{align:"center",face:"sans-serif",weight:"normal",style:"normal",size:"10px"},display:{labels:{aggregate:{show:!1,formatting:void 0,font:void 0},bars:{formatting:void 0,font:void 0,show:!0,hideSmallValueLabels:!0,hideThreshold:0,gradient:!1},x:{formatting:void 0,font:void 0,text:""},y:{formatting:void 0,font:void 0,text:""},tooltip:{formatting:void 0},axes:{formatting:void 0,font:void 0},legend:{formatting:void 0,font:void 0}},grid:{lines:"horizontal",tickPadding:7,tickCount:10},target:"body"},layout:{margin:{top:20,bottom:40,left:50,right:55},padding:30,width:960,height:500,graph:{style:"group",type:"value",bars:{direction:"vertical",spacing:0,maxWidth:null}},legend:{width:100,height:100,compass:"right"}},data:{graph:void 0,legend:void 0}},BarGraph.prototype.currentItem=0;var HorizontalBarGraph=function(a){var b=Merge.BarMerge(this.defaults,a);this.layout=b.layout,this.data=b.data,this.display=b.display;var c,d,e,f,g,h=this.data.graph[0].data.length,i=Object.keys(this.data.graph).length,j=this,k=function(){"group"==j.layout.graph.style?j.stackTransition(!1):j.groupTransition(!1)},l=function(){var a=[];for(var b in j.data.graph){var c=j.data.graph[b];c.total=0;for(var d in c.data){var e=c.data[d];c.total+=e.value}a.push({name:c.name,value:c.total})}return a}(),m=function(a){var b=[],c=[];for(var d in j.data.graph){var e=j.data.graph[d];b=b.concat(e.data[a]),c.push(e)}var f=function(a){return a.hidden?!1:0===j.display.labels.bars.hideThreshold?!0:a.value>j.display.labels.bars.hideThreshold},g=b.map(function(a,b){var d=function(a){return"percent"===j.layout.graph.type?Math.max(0,100*(a.value/c[b].total)):a.value},e=d(a);return{id:a.name+j.currentItem++,name:a.name,parent:c[b].name,dispValue:f(e)?e:0,x:b,y:f(a)?"percent"==j.layout.graph.type?Math.max(0,100*(a.value/c[b].total)):a.value:0}});return g},n=function(){if(c)return c;var a=[];return j.display.labels.aggregate.show&&(a=l.map(function(a,b){return{id:"agg"+j.currentItem++,isAggregate:!0,name:a.name,dispValue:a.value,x:b,y:a.value,y0:a.value}})),c=a,a},o=d3.layout.stack(),p=d3.range(h).map(function(a,b){return m(b)}),q=o(p);d3.max(q,function(a){return d3.max(a,function(a){return a.y})});var r=d3.max(q,function(a){return d3.max(a,function(a){return a.y0+a.y})});"value"==j.layout.graph.type&&(r+=Math.floor(r/10));var s,t,u,v,w=d3.tip().attr("class","d3-tip").html(function(a){return j.display.labels.tooltip.formatting.strFormat.split("%n").join(j.display.labels.tooltip.formatting.numFormat(a.dispValue))});w.offset([-5,0]);var x=function(){var a={x:function(a){var b=-a.compLen/2;return b+="stack"==j.layout.graph.style?a.isAggregate?f(a.y0):f(a.y0+a.y/2):f(a.y/2)},y:function(a,b,c){var d=g(a.x);if("stack"==j.layout.graph.style)d+=(j.layout.graph.bars.maxWidth?j.layout.graph.bars.maxWidth:g.rangeBand())/2;else{var e=g.rangeBand()/h;d+=e*c,d+=e/2,d+=j.layout.graph.bars.spacing/4}return d+a.compHeight/3}},b={x:function(a){var b=1;return"stack"==j.layout.graph.style&&(b+=f(a.y0)),b},y:function(b,c,d){return a.y(b,c,d)}},c={x:function(a){var b=0;return b+="stack"==j.layout.graph.style?f(a.y0+a.y):f(a.y),b-a.compLen-1},y:function(b,c,d){return a.y(b,c,d)}},d={x:function(b,c,d){return a.x(b,c,d)},y:function(a,b,c){var d=g(a.x);if("stack"==j.layout.graph.style)d+=j.layout.graph.bars.maxWidth?j.layout.graph.bars.maxWidth:g.rangeBand()/h,d-=a.compHeight;else{var e=g.rangeBand()/h;d+=e*c,d+=e/2,d-=a.compHeight/3,d+=j.layout.graph.bars.spacing/4}return d}},e={x:function(b,c,d){return a.x(b,c,d)},y:function(a,b,c){var d=g(a.x);if("stack"==j.layout.graph.style)d+=j.layout.graph.bars.maxWidth?j.layout.graph.bars.maxWidth:g.rangeBand();else{var e=g.rangeBand()/h;d+=e*(c+1),d+=j.layout.graph.bars.spacing/4}return d-=a.compHeight/3}};switch(j.display.labels.bars.font.align){case"center":return a;case"left":return b;case"right":return c;case"top":return d;case"bottom":return e;default:console.error("invalid formatting.bars.textalign "+j.display.labels.bars.font.align)}};j.redraw=function(){var a=function(){switch(j.layout.legend.compass){case"left":return{x:-j.layout.width-j.layout.padding-j.layout.margin.left,y:j.layout.height/2-j.layout.legend.height/2,offsetX:j.layout.legend.width,offsetY:0};case"right":return{x:-j.layout.margin.right,y:j.layout.height/2-j.layout.legend.height/2,offsetX:0,offsetY:0};case"bottom":return{x:j.layout.width/2-j.layout.legend.width/2,y:j.layout.margin.bottom/2+j.layout.legend.height/2,offsetX:0,offsetY:0};case"top":return{x:j.layout.width/2-j.layout.legend.width/2,y:-j.layout.height-j.layout.legend.height/2,offsetX:0,offsetY:0};default:console.error("invalid legend position "+j.layout.legend.compass)}},b=function(){var a={width:j.layout.width+j.layout.margin.left+j.layout.margin.right,height:j.layout.height+j.layout.margin.top+j.layout.margin.bottom+j.layout.padding,offsetX:j.layout.margin.left,offsetY:j.layout.margin.top};switch(j.layout.legend.compass){case"left":a.offsetX+=j.layout.legend.width;break;case"bottom":a.offsetY+=j.layout.legend.height/2}return a};f=d3.scale.linear().domain([r,0]).range([j.layout.width,0]),g=d3.scale.ordinal().domain(d3.range(i)).rangeRoundBands([0,j.layout.height],.08),d=d3.svg.axis().scale(f).tickSize(-1!==j.display.grid.lines.indexOf("vert")?-j.layout.width:0,0,0).tickPadding(j.display.grid.tickPadding).ticks(j.display.grid.tickCount).orient("bottom"),e=d3.svg.axis().scale(g).orient("left").tickSize(0).tickPadding(j.display.grid.tickPadding);var c=function(){var a=b();return v&&d3.select("svg").remove(),v=d3.select(j.display.target).append("svg").attr("width",a.width).attr("height",a.height).attr("class","graph-horizontal").append("g").attr("transform","translate("+a.offsetX+","+a.offsetY+")"),v.append("g").attr("class","grid").call(e),v.append("g").attr("class","y axis").attr("stroke-width","0").attr("transform","translate(-10,0)").call(e),v.append("g").attr("class","x axis").attr("transform","translate(0,"+j.layout.height+")").call(d),v.append("g").attr("class","legend container").append("rect").attr("class","x label legend").style("fill","#cac").style("stroke","#000").style("stroke-width","1px").attr("x",j.layout.width/2).attr("y",j.layout.height+j.layout.padding).call(d),v.append("text").attr("class","y label").attr("text-anchor","end").attr("y",-25).attr("x",-j.layout.height/2).attr("dy",".75em").attr("transform","rotate(-90)").style("font-family",j.display.labels.y.font.face).style("font-size",j.display.labels.y.font.size).style("font-weight",j.display.labels.y.font.weight).style("font-style",j.display.labels.y.font.style).text(j.display.labels.y.text),v.append("text").attr("class","x label").attr("text-anchor","end").attr("x",j.layout.width/2).attr("y",j.layout.height+20).attr("dy",".75em").style("font-family",j.display.labels.x.font.face).style("font-size",j.display.labels.x.font.size).style("font-weight",j.display.labels.x.font.weight).style("font-style",j.display.labels.x.font.style).text(j.display.labels.x.text),v.append("foreignObject").attr("width",32).attr("height",32).attr("x",j.layout.width-j.layout.padding).attr("y",0).attr("class","swap-icon").on("mousedown",k).append("xhtml:body").html("<i class='fa fa-tasks'></i>"),v.call(w),v}();!function(){var a=c.append("svg:defs");for(var b in j.data.legend){var d=j.data.legend[b],e=a.append("svg:linearGradient").attr("id","gradient-"+d.name).attr("x1","50%").attr("y1","0%").attr("x2","50%").attr("y2","100%");e.append("svg:stop").attr("offset","1%").attr("stop-color","#fff"),e.append("svg:stop").attr("offset","100%").attr("stop-color",d.color)}}();var h=c.selectAll(".layer").data(q).enter().append("g").attr("class","layer").style("fill",function(a,b){return j.isGradient?"url(#gradient-"+j.data.legend[b].name+")":j.data.legend[b].color}),l=h.selectAll("rect").data(function(a){return a});s=function(){return l.enter().append("rect").attr("class","bar").on("mouseover",w.show).on("mouseout",w.hide).on("mousedown",function(a){console.debug(a.parent+" "+a.dispValue)}).style("stroke","#000").style("stroke-width","1px")}(),t=function(){var a=l.enter().append("text").text(function(a){return 0!==a.dispValue&&j.display.labels.bars.show?j.display.labels.bars.formatting.strFormat.split("%n").join(j.display.labels.bars.formatting.numFormat(a.dispValue)):""}).attr("class",function(a){return"rectInner "+a.id}).style("pointer-events","none").style("font-family",j.display.labels.bars.font.face).style("font-size",j.display.labels.bars.font.size).style("font-weight",j.display.labels.bars.font.weight).style("font-style",j.display.labels.bars.font.style).style("fill","#000");return a.each(function(){var a=d3.select(this),b=this.getBBox().width,c=this.getBBox().height;a.attr("x",function(d){return d.compLen=b,d.compHeight=c,a.attr("x")})}),a}(),j.display.labels.aggregate.show&&(u=function(){var a=n();d3.range(i).map(function(b,c){v.append("text").text(a[c].dispValue).attr("class","rectInner aggregate").style("font-family",j.display.labels.bars.font.face).style("font-size",j.display.labels.bars.font.size).style("font-weight",j.display.labels.bars.font.weight).style("font-style",j.display.labels.bars.font.style).style("fill","#000")});var b=v.selectAll(".aggregate");return b.each(function(b,c){d3.select(this);var d=this.getBBox().width,e=this.getBBox().height;a[c].compLen=d,a[c].compHeight=e}),b}()),!function(){var b=function(a){var b=a?13:0;switch(j.layout.legend.compass){case"right":return function(){return j.layout.width+j.layout.margin.right+b};case"left":return function(){return j.layout.width+j.layout.margin.left+b};case"bottom":case"top":return function(a,c){return 30*c+b}}},d=function(a){var b=a?8:0;switch(j.layout.legend.compass){case"right":case"left":return function(a,c){return 20*c+b};case"bottom":case"top":return function(){return j.layout.height+b}}},e=c.append("g").attr("class","legend").attr("height",j.layout.legend.height).attr("width",j.layout.legend.width);e.selectAll("rect").data(j.data.legend).enter().append("rect").attr("x",b()).attr("y",d()).attr("width",10).attr("height",10).on("mousedown",function(a){console.debug(a)}).style("fill",function(a){return a.color}),e.selectAll("text").data(j.data.legend).enter().append("text").attr("x",b(!0)).attr("y",d(!0)).style("font-family",j.display.labels.legend.font.face).style("font-size",j.display.labels.legend.font.size).style("font-weight",j.display.labels.legend.font.weight).style("font-style",j.display.labels.legend.font.style).text(function(a){return a.name});var f=0,g=0;e.each(function(){f++;var a=this.getBBox().width;a>g&&(g=a);var b=d3.select(this);b.attr("x",parseInt(b.attr("x"))+10)}),j.layout.legend.width=g*f;var h=a();return e.attr("transform","translate("+(h.x-h.offsetX)+","+(h.y-h.offsetY)+")"),e}()};var y=function(){v.selectAll(".y.axis .tick text").text(function(a){return j.data.graph[a].name}).attr("transform","rotate(-90)").each(function(){var a=d3.select(this),b=this.getBBox().width;a.attr("x",parseInt(a.attr("x"))+b/2)}),v.selectAll(".axis .tick text").style("font-family",j.display.labels.bars.font.face).style("font-size",j.display.labels.bars.font.size).style("font-weight",j.display.labels.bars.font.weight).style("font-style",j.display.labels.bars.font.style),v.selectAll(".grid .tick text").style("display","none"),v.selectAll(".label").each(function(){var a=d3.select(this);if("true"!==a.attr("data-centered")){var b=this.getBBox().width,c=parseInt(a.attr("x"))+b/2;a.attr("x",c),a.attr("data-centered","true")}})};j.groupTransition=function(a){j.layout.graph.style="group";var b=x();s.transition().duration(a?0:500).delay(function(b,c){return a?0:10*c}).attr("x",function(){return 0}).attr("width",function(a){return f(a.y)}).transition().duration(a?0:250).attr("y",function(a,b,c){return g(a.x)+g.rangeBand()/h*c}).attr("height",function(){return(j.layout.graph.bars.maxWidth?j.layout.graph.bars.maxWidth:g.rangeBand()/h)-j.layout.graph.bars.spacing/2}).each("end",function(a){var b=d3.select(this),c=v.select("."+a.id),d=b.attr("width");j.display.labels.bars.hideSmallValueLabels&&d<=a.compLen?c.style("visibility","hidden"):c.style("visibility","visible")}),t.transition().duration(a?0:500).delay(function(b,c){return a?0:10*c}).attr("x",b.x).transition().duration(a?0:250).attr("y",b.y),j.display.labels.aggregate.show&&u.transition().duration(a?0:500).delay(function(b,c){return a?0:10*c}).attr("opacity",0)},j.stackTransition=function(a){j.layout.graph.style="stack";var b=x();if(s.transition().duration(a?0:500).delay(function(b,c){return a?0:10*c}).attr("y",function(a){return g(a.x)}).attr("height",function(){return j.layout.graph.bars.maxWidth?j.layout.graph.bars.maxWidth:g.rangeBand()}).transition().duration(a?0:250).attr("x",function(a){return f(a.y0)}).attr("width",function(a){return f(a.y)}).each("end",function(a){var b=d3.select(this),c=v.select("."+a.id),d=b.attr("width");j.display.labels.bars.hideSmallValueLabels&&d<=a.compLen?c.style("visibility","hidden"):c.style("visibility","visible")}),t.transition().duration(a?0:500).delay(function(b,c){return a?0:10*c}).attr("y",b.y).transition().duration(a?0:250).attr("x",b.x),j.display.labels.aggregate.show){var c=n();u.transition().duration(a?0:500).delay(function(b,c){return a?0:10*c}).attr("opacity",1).attr("x",function(a,d,e){return b.x(c[d],d,e)+1+c[d].compLen/2}).transition().duration(a?0:250).attr("y",function(a,d,e){return b.y(c[d],d,e)})}},j.redraw(),y(),function(){switch(j.layout.graph.style){case"group":return j.groupTransition(!0),void 0;case"stack":return j.stackTransition(!0),void 0;default:console.error("invalid layout style "+j.layout.graph.style)}}()};HorizontalBarGraph.prototype.defaults={formatting:{numFormat:"",strFormat:"%n",formatter:function(a){return a}},font:{align:"center",face:"sans-serif",weight:"normal",style:"normal",size:"10px"},display:{labels:{aggregate:{show:!1,formatting:void 0,font:void 0},bars:{formatting:void 0,font:void 0,show:!0,swap:!1,hideSmallValueLabels:!0,hideThreshold:0,gradient:!1},x:{formatting:void 0,font:void 0,text:""},y:{formatting:void 0,font:void 0,text:""},tooltip:{formatting:void 0},axes:{formatting:void 0,font:void 0},legend:{formatting:void 0,font:void 0}},grid:{lines:"vertical",tickPadding:7,tickCount:10},target:"body"},layout:{margin:{top:20,bottom:40,left:50,right:55},padding:30,width:960,height:500,graph:{style:"group",type:"value",bars:{direction:"vertical",spacing:0,maxWidth:null}},legend:{width:100,height:100,compass:"right"}},data:{graph:void 0,legend:void 0}},HorizontalBarGraph.prototype.currentItem=0;
//# sourceMappingURL=dist/production/d3ca.map.js