var BarGraph=function(a){var b=this.merge(this.defaults,a);b.layout.width=b.layout.width-b.layout.margin.left-b.layout.margin.right,b.layout.height=b.layout.height-b.layout.margin.top-b.layout.margin.bottom;var c=[b.display.labels.aggregate,b.display.labels.tooltip,b.display.labels.legend,b.display.labels.axes,b.display.labels.bars,b.display.labels.x,b.display.labels.y];b.display.labels.tooltip.formatting=b.display.labels.tooltip.formatting||b.display.labels.bars.formatting,c.forEach(function(a){a.formatting=a.formatting||b.formatting,"function"!=typeof a.formatting.numFormat&&(a.formatting.numFormat=d3.format(a.formatting.numFormat))});var d=[b.display.labels.aggregate,b.display.labels.tooltip,b.display.labels.legend,b.display.labels.axes,b.display.labels.bars,b.display.labels.x,b.display.labels.y];d.forEach(function(a){a.font=a.font||b.font}),this.layout=b.layout,this.data=b.data,this.display=b.display;var e,f,g,h,i,j=this.data.graph[0].data.length,k=Object.keys(this.data.graph).length,l=this,m=function(){"group"==l.layout.graph.style?l.stackTransition(!1):l.groupTransition(!1)},n=function(){var a=[];for(var b in l.data.graph){var c=l.data.graph[b];c.total=0;for(var d in c.data){var e=c.data[d];c.total+=e.value}a.push({name:c.name,value:c.total})}return a}(),o=function(a){var b=[],c=[];for(var d in l.data.graph){var e=l.data.graph[d];b=b.concat(e.data[a]),c.push(e)}var f=function(a){return a.hidden?!1:0===l.display.labels.bars.hideThreshold?!0:a.value>l.display.labels.bars.hideThreshold},g=b.map(function(a,b){var d=function(a){return"percent"===l.layout.graph.type?Math.max(0,100*(a.value/c[b].total)):a.value},e=d(a);return{id:a.name+l.currentItem++,name:a.name,parent:c[b].name,dispValue:f(e)?e:0,x:b,y:f(a)?"percent"==l.layout.graph.type?Math.max(0,100*(a.value/c[b].total)):a.value:0}});return g},p=function(){if(e)return e;var a=[];return l.display.labels.aggregate.show&&(a=n.map(function(a,b){return{id:"agg"+l.currentItem++,isAggregate:!0,name:a.name,dispValue:a.value,x:b,y:a.value,y0:a.value}})),e=a,a},q=d3.layout.stack(),r=d3.range(j).map(function(a,b){return o(b)}),s=q(r),t=d3.max(s,function(a){return d3.max(a,function(a){return a.y})}),u=d3.max(s,function(a){return d3.max(a,function(a){return a.y0+a.y})});"value"==l.layout.graph.type&&(u+=Math.floor(u/10));var v,w,x,y,z=d3.tip().attr("class","d3-tip").html(function(a){return l.display.labels.tooltip.formatting.strFormat.split("%n").join(l.display.labels.tooltip.formatting.numFormat(a.dispValue))});z.offset([-5,0]);var A=function(){var a={x:function(a,b,c){var d=h(a.x);return"stack"==l.layout.graph.style?d+=(l.layout.graph.bars.maxWidth?l.layout.graph.bars.maxWidth:h.rangeBand())/2:(d+=l.layout.graph.bars.spacing/4,d+=h.rangeBand()/j*c,d+=(l.layout.graph.bars.maxWidth?l.layout.graph.bars.maxWidth:h.rangeBand()/j)/2),d-a.compLen/2},y:function(a){var b=a.compHeight/3;return b+="stack"==l.layout.graph.style?a.isAggregate?i(a.y0):i(a.y0+a.y/2):i(a.y/2)},height:function(a){return"stack"==l.layout.graph.style?i(a.y0)-i(a.y0+a.y):l.layout.height-i(a.y)},width:function(){return"stack"==l.layout.graph.style?h.rangeBand():(l.layout.graph.bars.maxWidth?l.layout.graph.bars.maxWidth:h.rangeBand()/j)/2}},b={x:function(b,c,d){var e=a.x(b,c,d);return e-="stack"==l.layout.graph.style?(l.layout.graph.bars.maxWidth?l.layout.graph.bars.maxWidth:h.rangeBand())/2:(l.layout.graph.bars.maxWidth?l.layout.graph.bars.maxWidth:h.rangeBand()/j)/2,e+=b.compLen/2},y:function(b){return a.y(b)},height:function(b){return a.height(b)},width:function(b){return a.width(b)}},c={x:function(b,c,d){var e=a.x(b,c,d);return e+="stack"==l.layout.graph.style?(l.layout.graph.bars.maxWidth?l.layout.graph.bars.maxWidth:h.rangeBand())/2:(l.layout.graph.bars.maxWidth?l.layout.graph.bars.maxWidth:h.rangeBand()/j)/2,e-=b.compLen/2},y:function(b){return a.y(b)},height:function(b){return a.height(b)},width:function(b){return a.width(b)}},d={x:function(b,c,d){return a.x(b,c,d)},y:function(a){var b=0;return b+="stack"==l.layout.graph.style?i(a.y0+a.y):i(a.y),b+=a.compHeight},height:function(b){return a.height(b)},width:function(b){return a.width(b)}},e={x:function(b,c,d){return a.x(b,c,d)},y:function(a){var b=0;return b+="stack"==l.layout.graph.style?i(a.y0):i(0),b-=a.compHeight/4},height:function(b){return a.height(b)},width:function(b){return a.width(b)}};switch(l.display.labels.bars.font.align){case"center":return a;case"left":return b;case"right":return c;case"top":return d;case"bottom":return e;default:console.error("invalid formatting.bars.textalign "+l.display.labels.bars.font.align)}};l.redraw=function(){var a=function(){switch(l.layout.legend.compass){case"left":return{x:-l.layout.width-l.layout.padding-l.layout.margin.left,y:l.layout.height/2-l.layout.legend.height/2,offsetX:l.layout.legend.width,offsetY:0};case"right":return{x:-l.layout.margin.right,y:l.layout.height/2-l.layout.legend.height/2,offsetX:0,offsetY:0};case"bottom":return{x:l.layout.width/2-l.layout.legend.width/2,y:l.layout.margin.bottom/2+l.layout.legend.height/2,offsetX:0,offsetY:0};case"top":return{x:l.layout.width/2-l.layout.legend.width/2,y:-l.layout.height-l.layout.legend.height/2,offsetX:0,offsetY:0};default:console.error("invalid legend position "+l.layout.legend.compass)}},b=function(){var a={width:l.layout.width+l.layout.margin.left+l.layout.margin.right,height:l.layout.height+l.layout.margin.top+l.layout.margin.bottom+l.layout.padding,offsetX:l.layout.margin.left,offsetY:l.layout.margin.top};switch(l.layout.legend.compass){case"left":a.offsetX+=l.layout.legend.width;break;case"bottom":a.offsetY+=l.layout.legend.height/2}return a};h=d3.scale.ordinal().domain(d3.range(k)).rangeRoundBands([0,l.layout.width],.08),i=d3.scale.linear().domain([0,u]).range([l.layout.height,0]),f=d3.svg.axis().scale(h).tickSize(0).tickPadding(l.display.grid.tickPadding).orient("bottom"),g=d3.svg.axis().scale(i).orient("left").tickSize(-1!==l.display.grid.lines.indexOf("horiz")?-l.layout.width:0,0,0).tickPadding(l.display.grid.tickPadding).ticks(l.display.grid.tickCount);var c=function(){var a=b();return y&&d3.select("svg").remove(),y=d3.select(l.display.target).append("svg").attr("width",a.width).attr("height",a.height).attr("class","graph-vertical").append("g").attr("transform","translate("+a.offsetX+","+a.offsetY+")"),y.append("g").attr("class","grid").call(g),y.append("g").attr("class","y axis").attr("stroke-width","0").attr("transform","translate(20,0)").call(g),y.append("g").attr("class","x axis").attr("transform","translate(0,"+l.layout.height+")").call(f),y.append("g").attr("class","legend container").append("rect").attr("class","x label legend").style("fill","#cac").style("stroke","#000").style("stroke-width","1px").attr("x",l.layout.width/2).attr("y",l.layout.height+l.layout.padding).call(f),y.append("text").attr("class","y label").attr("text-anchor","end").attr("y",-20).attr("x",-l.layout.height/2).attr("dy",".75em").attr("transform","rotate(-90)").style("font-family",l.display.labels.y.font.face).style("font-size",l.display.labels.y.font.size).style("font-weight",l.display.labels.y.font.weight).style("font-style",l.display.labels.y.font.style).text(l.display.labels.y.text),y.append("text").attr("class","x label").attr("text-anchor","end").attr("x",l.layout.width/2).attr("y",l.layout.height+20).attr("dy",".75em").style("font-family",l.display.labels.x.font.face).style("font-size",l.display.labels.x.font.size).style("font-weight",l.display.labels.x.font.weight).style("font-style",l.display.labels.x.font.style).text(l.display.labels.x.text),y.append("foreignObject").attr("width",32).attr("height",32).attr("x",l.layout.width-l.layout.padding).attr("y",0).attr("class","swap-icon").on("mousedown",m).append("xhtml:body").html("<i class='fa fa-tasks'></i>"),y.call(z),y}();!function(){var a=c.append("svg:defs");for(var b in l.data.legend){var d=l.data.legend[b],e=a.append("svg:linearGradient").attr("id","gradient-"+d.name).attr("x1","50%").attr("y1","0%").attr("x2","50%").attr("y2","100%");e.append("svg:stop").attr("offset","1%").attr("stop-color","#fff"),e.append("svg:stop").attr("offset","100%").attr("stop-color",d.color)}}();var d=c.selectAll(".layer").data(s).enter().append("g").attr("class","layer").style("fill",function(a,b){return l.isGradient?"url(#gradient-"+l.data.legend[b].name+")":l.data.legend[b].color}),e=d.selectAll("rect").data(function(a){return a});v=function(){return e.enter().append("rect").attr("class","bar").on("mouseover",z.show).on("mouseout",z.hide).on("mousedown",function(a){console.debug(a.parent+" "+a.dispValue)}).style("stroke","#000").style("stroke-width","1px")}(),w=function(){var a=e.enter().append("text").text(function(a){return 0!==a.dispValue&&l.display.labels.bars.show?l.display.labels.bars.formatting.strFormat.split("%n").join(l.display.labels.bars.formatting.numFormat(a.dispValue)):""}).attr("width",l.layout.graph.bars.maxWidth?l.layout.graph.bars.maxWidth:h.rangeBand()).attr("class",function(a){return"rectInner "+a.id}).style("pointer-events","none").style("font-family",l.display.labels.bars.font.face).style("font-size",l.display.labels.bars.font.size).style("font-weight",l.display.labels.bars.font.weight).style("font-style",l.display.labels.bars.font.style).style("fill","#000");return a.each(function(){var a=d3.select(this),b=this.getBBox().width,c=this.getBBox().height;a.attr("x",function(d){return d.compLen=b,d.compHeight=c,a.attr("x")})}),a}(),l.display.labels.aggregate.show&&(x=function(){var a=p();d3.range(k).map(function(b,c){y.append("text").text(a[c].dispValue).attr("class","rectInner aggregate").style("font-family",l.display.labels.bars.font.face).style("font-size",l.display.labels.bars.font.size).style("font-weight",l.display.labels.bars.font.weight).style("font-style",l.display.labels.bars.font.style).style("fill","#000")});var b=y.selectAll(".aggregate");return b.each(function(b,c){d3.select(this);var d=this.getBBox().width,e=this.getBBox().height;a[c].compLen=d,a[c].compHeight=e}),b}()),!function(){var b=function(a){var b=a?13:0;switch(l.layout.legend.compass){case"right":return function(){return l.layout.width+l.layout.margin.right+b};case"left":return function(){return l.layout.width+l.layout.margin.left+b};case"bottom":case"top":return function(a,c){return 30*c+b}}},d=function(a){var b=a?8:0;switch(l.layout.legend.compass){case"right":case"left":return function(a,c){return 20*c+b};case"bottom":case"top":return function(){return l.layout.height+b}}},e=c.append("g").attr("class","legend").attr("height",l.layout.legend.height).attr("width",l.layout.legend.width);e.selectAll("rect").data(l.data.legend).enter().append("rect").attr("x",b()).attr("y",d()).attr("width",10).attr("height",10).on("mousedown",function(a){console.debug(a)}).style("fill",function(a){return a.color}),e.selectAll("text").data(l.data.legend).enter().append("text").attr("x",b(!0)).attr("y",d(!0)).style("font-family",l.display.labels.legend.font.face).style("font-size",l.display.labels.legend.font.size).style("font-weight",l.display.labels.legend.font.weight).style("font-style",l.display.labels.legend.font.style).text(function(a){return a.name});var f=0,g=0;e.each(function(){f++;var a=this.getBBox().width;a>g&&(g=a);var b=d3.select(this);b.attr("x",parseInt(b.attr("x"))+10)}),l.layout.legend.width=g*f;var h=a();return e.attr("transform","translate("+(h.x-h.offsetX)+","+(h.y-h.offsetY)+")"),e}()};var B=function(){y.selectAll(".x.axis .tick text").text(function(a){return l.data.graph[a].name}),y.selectAll(".axis .tick text").style("font-family",l.display.labels.bars.font.face).style("font-size",l.display.labels.bars.font.size).style("font-weight",l.display.labels.bars.font.weight).style("font-style",l.display.labels.bars.font.style),y.selectAll(".grid .tick text").style("display","none"),y.selectAll(".label").each(function(){var a=d3.select(this);if("true"!==a.attr("data-centered")){var b=this.getBBox().width,c=parseInt(a.attr("x"))+b/2;a.attr("x",c),a.attr("data-centered","true")}})};l.groupTransition=function(a){l.layout.graph.style="group";var b=A(),c=2.5*t;"percent"==l.layout.type&&(c*=2/3),i.domain([0,c]),v.transition().duration(a?0:500).delay(function(b,c){return a?0:10*c}).attr("x",function(a,b,c){return h(a.x)+l.layout.graph.bars.spacing/2+h.rangeBand()/j*c}).attr("width",(l.layout.graph.bars.maxWidth?l.layout.graph.bars.maxWidth:h.rangeBand()/j)-l.layout.graph.bars.spacing/2).transition().duration(a?0:250).attr("y",function(a){return i(a.y)}).attr("height",function(a){return l.layout.height-i(a.y)}),w.transition().duration(a?0:500).delay(function(b,c){return a?0:10*c}).attr("x",b.x).attr("width",b.width).transition().duration(a?0:250).attr("y",b.y).attr("height",b.height).each("end",function(a){var b=d3.select(this),c=y.select("."+a.id),d=b.attr("height");l.display.labels.bars.hideSmallValueLabels&&d<=a.compHeight?c.style("visibility","hidden"):c.style("visibility","visible")}),l.display.labels.aggregate.show&&x.transition().duration(a?0:500).delay(function(b,c){return a?0:10*c}).attr("opacity",0),B()},l.stackTransition=function(a){l.layout.graph.style="stack";var b=A();if(i.domain([0,u]),v.transition().duration(a?0:500).delay(function(b,c){return a?0:10*c}).attr("y",function(a){return i(a.y0+a.y)}).attr("height",function(a){return i(a.y0)-i(a.y0+a.y)}).transition().duration(a?0:250).attr("x",function(a){return h(a.x)}).attr("width",l.layout.graph.bars.maxWidth?l.layout.graph.bars.maxWidth:h.rangeBand()),w.transition().duration(a?0:500).delay(function(b,c){return a?0:10*c}).attr("y",b.y).attr("height",b.height).transition().duration(a?0:250).attr("x",b.x).attr("width",b.width).each("end",function(a){var b=d3.select(this),c=y.select("."+a.id),d=b.attr("height");l.display.labels.bars.hideSmallValueLabels&&d<=a.compHeight?c.style("visibility","hidden"):c.style("visibility","visible")}),l.display.labels.aggregate.show){var c=p();x.transition().duration(a?0:500).delay(function(b,c){return a?0:10*c}).attr("opacity",1).attr("y",function(a,d,e){return b.y(c[d],d,e)-c[d].compHeight/2}).attr("height",function(a,d,e){return b.height(c[d],d,e)}).transition().duration(a?0:250).attr("x",function(a,d,e){return b.x(c[d],d,e)}).attr("width",function(a,d,e){return b.width(c[d],d,e)})}B()},l.redraw(),function(){switch(l.layout.graph.style){case"group":return l.groupTransition(!0),void 0;case"stack":return l.stackTransition(!0),void 0;default:console.error("invalid layout style "+l.layout.graph.style)}}()};BarGraph.prototype.defaults={formatting:{numFormat:"",strFormat:"%n",formatter:function(a){return a}},font:{align:"center",face:"sans-serif",weight:"normal",style:"normal",size:"10px"},display:{labels:{aggregate:{show:!1,formatting:void 0,font:void 0},bars:{formatting:void 0,font:void 0,show:!0,hideSmallValueLabels:!0,hideThreshold:0,gradient:!1},x:{formatting:void 0,font:void 0,text:""},y:{formatting:void 0,font:void 0,text:""},tooltip:{formatting:void 0},axes:{formatting:void 0,font:void 0},legend:{formatting:void 0,font:void 0}},grid:{lines:"horizontal",tickPadding:7,tickCount:10},target:"body"},layout:{margin:{top:20,bottom:40,left:50,right:55},padding:30,width:960,height:500,graph:{style:"group",type:"value",bars:{direction:"vertical",spacing:0,maxWidth:null}},legend:{width:100,height:100,compass:"right"}},data:{graph:void 0,legend:void 0}},BarGraph.prototype.merge=function(a,b){var c=JSON.parse(JSON.stringify(a));for(var d in a)b.hasOwnProperty(d)&&(c[d]="object"==typeof a[d]?this.merge(a[d],b[d]):b[d]);return c},BarGraph.prototype.currentItem=0;var HorizontalBarGraph=function(a){var b=this.merge(this.defaults,a);b.layout.width=b.layout.width-b.layout.margin.left-b.layout.margin.right,b.layout.height=b.layout.height-b.layout.margin.top-b.layout.margin.bottom;var c=[b.display.labels.aggregate,b.display.labels.tooltip,b.display.labels.legend,b.display.labels.axes,b.display.labels.bars,b.display.labels.x,b.display.labels.y];b.display.labels.tooltip.formatting=b.display.labels.tooltip.formatting||b.display.labels.bars.formatting,c.forEach(function(a){a.formatting=a.formatting||b.formatting,"function"!=typeof a.formatting.numFormat&&(a.formatting.numFormat=d3.format(a.formatting.numFormat))});var d=[b.display.labels.aggregate,b.display.labels.tooltip,b.display.labels.legend,b.display.labels.axes,b.display.labels.bars,b.display.labels.x,b.display.labels.y];d.forEach(function(a){a.font=a.font||b.font}),this.layout=b.layout,this.data=b.data,this.display=b.display;var e,f,g,h,i,j=this.data.graph[0].data.length,k=Object.keys(this.data.graph).length,l=this,m=function(){"group"==l.layout.graph.style?l.stackTransition(!1):l.groupTransition(!1)},n=function(){var a=[];for(var b in l.data.graph){var c=l.data.graph[b];c.total=0;for(var d in c.data){var e=c.data[d];c.total+=e.value}a.push({name:c.name,value:c.total})}return a}(),o=function(a){var b=[],c=[];for(var d in l.data.graph){var e=l.data.graph[d];b=b.concat(e.data[a]),c.push(e)}var f=function(a){return a.hidden?!1:0===l.display.labels.bars.hideThreshold?!0:a.value>l.display.labels.bars.hideThreshold},g=b.map(function(a,b){var d=function(a){return"percent"===l.layout.graph.type?Math.max(0,100*(a.value/c[b].total)):a.value},e=d(a);return{id:a.name+l.currentItem++,name:a.name,parent:c[b].name,dispValue:f(e)?e:0,x:b,y:f(a)?"percent"==l.layout.graph.type?Math.max(0,100*(a.value/c[b].total)):a.value:0}});return g},p=function(){if(e)return e;var a=[];return l.display.labels.aggregate.show&&(a=n.map(function(a,b){return{id:"agg"+l.currentItem++,isAggregate:!0,name:a.name,dispValue:a.value,x:b,y:a.value,y0:a.value}})),e=a,a},q=d3.layout.stack(),r=d3.range(j).map(function(a,b){return o(b)}),s=q(r);d3.max(s,function(a){return d3.max(a,function(a){return a.y})});var t=d3.max(s,function(a){return d3.max(a,function(a){return a.y0+a.y})});"value"==l.layout.graph.type&&(t+=Math.floor(t/10));var u,v,w,x,y=d3.tip().attr("class","d3-tip").html(function(a){return l.display.labels.tooltip.formatting.strFormat.split("%n").join(l.display.labels.tooltip.formatting.numFormat(a.dispValue))});y.offset([-5,0]);var z=function(){var a={x:function(a){var b=-a.compLen/2;return b+="stack"==l.layout.graph.style?a.isAggregate?h(a.y0):h(a.y0+a.y/2):h(a.y/2)},y:function(a,b,c){var d=i(a.x);if("stack"==l.layout.graph.style)d+=(l.layout.graph.bars.maxWidth?l.layout.graph.bars.maxWidth:i.rangeBand())/2;else{var e=i.rangeBand()/j;d+=e*c,d+=e/2,d+=l.layout.graph.bars.spacing/4}return d+a.compHeight/3}},b={x:function(a){var b=1;return"stack"==l.layout.graph.style&&(b+=h(a.y0)),b},y:function(b,c,d){return a.y(b,c,d)}},c={x:function(a){var b=0;return b+="stack"==l.layout.graph.style?h(a.y0+a.y):h(a.y),b-a.compLen-1},y:function(b,c,d){return a.y(b,c,d)}},d={x:function(b,c,d){return a.x(b,c,d)},y:function(a,b,c){var d=i(a.x);if("stack"==l.layout.graph.style)d+=l.layout.graph.bars.maxWidth?l.layout.graph.bars.maxWidth:i.rangeBand()/j,d-=a.compHeight;else{var e=i.rangeBand()/j;d+=e*c,d+=e/2,d-=a.compHeight/3,d+=l.layout.graph.bars.spacing/4}return d}},e={x:function(b,c,d){return a.x(b,c,d)},y:function(a,b,c){var d=i(a.x);if("stack"==l.layout.graph.style)d+=l.layout.graph.bars.maxWidth?l.layout.graph.bars.maxWidth:i.rangeBand();else{var e=i.rangeBand()/j;d+=e*(c+1),d+=l.layout.graph.bars.spacing/4}return d-=a.compHeight/3}};switch(l.display.labels.bars.font.align){case"center":return a;case"left":return b;case"right":return c;case"top":return d;case"bottom":return e;default:console.error("invalid formatting.bars.textalign "+l.display.labels.bars.font.align)}};l.redraw=function(){var a=function(){switch(l.layout.legend.compass){case"left":return{x:-l.layout.width-l.layout.padding-l.layout.margin.left,y:l.layout.height/2-l.layout.legend.height/2,offsetX:l.layout.legend.width,offsetY:0};case"right":return{x:-l.layout.margin.right,y:l.layout.height/2-l.layout.legend.height/2,offsetX:0,offsetY:0};case"bottom":return{x:l.layout.width/2-l.layout.legend.width/2,y:l.layout.margin.bottom/2+l.layout.legend.height/2,offsetX:0,offsetY:0};case"top":return{x:l.layout.width/2-l.layout.legend.width/2,y:-l.layout.height-l.layout.legend.height/2,offsetX:0,offsetY:0};default:console.error("invalid legend position "+l.layout.legend.compass)}},b=function(){var a={width:l.layout.width+l.layout.margin.left+l.layout.margin.right,height:l.layout.height+l.layout.margin.top+l.layout.margin.bottom+l.layout.padding,offsetX:l.layout.margin.left,offsetY:l.layout.margin.top};switch(l.layout.legend.compass){case"left":a.offsetX+=l.layout.legend.width;break;case"bottom":a.offsetY+=l.layout.legend.height/2}return a};h=d3.scale.linear().domain([t,0]).range([l.layout.width,0]),i=d3.scale.ordinal().domain(d3.range(k)).rangeRoundBands([0,l.layout.height],.08),f=d3.svg.axis().scale(h).tickSize(-1!==l.display.grid.lines.indexOf("vert")?-l.layout.width:0,0,0).tickPadding(l.display.grid.tickPadding).ticks(l.display.grid.tickCount).orient("bottom"),g=d3.svg.axis().scale(i).orient("left").tickSize(0).tickPadding(l.display.grid.tickPadding);var c=function(){var a=b();return x&&d3.select("svg").remove(),x=d3.select(l.display.target).append("svg").attr("width",a.width).attr("height",a.height).attr("class","graph-horizontal").append("g").attr("transform","translate("+a.offsetX+","+a.offsetY+")"),x.append("g").attr("class","grid").call(g),x.append("g").attr("class","y axis").attr("stroke-width","0").attr("transform","translate(-10,0)").call(g),x.append("g").attr("class","x axis").attr("transform","translate(0,"+l.layout.height+")").call(f),x.append("g").attr("class","legend container").append("rect").attr("class","x label legend").style("fill","#cac").style("stroke","#000").style("stroke-width","1px").attr("x",l.layout.width/2).attr("y",l.layout.height+l.layout.padding).call(f),x.append("text").attr("class","y label").attr("text-anchor","end").attr("y",-25).attr("x",-l.layout.height/2).attr("dy",".75em").attr("transform","rotate(-90)").style("font-family",l.display.labels.y.font.face).style("font-size",l.display.labels.y.font.size).style("font-weight",l.display.labels.y.font.weight).style("font-style",l.display.labels.y.font.style).text(l.display.labels.y.text),x.append("text").attr("class","x label").attr("text-anchor","end").attr("x",l.layout.width/2).attr("y",l.layout.height+20).attr("dy",".75em").style("font-family",l.display.labels.x.font.face).style("font-size",l.display.labels.x.font.size).style("font-weight",l.display.labels.x.font.weight).style("font-style",l.display.labels.x.font.style).text(l.display.labels.x.text),x.append("foreignObject").attr("width",32).attr("height",32).attr("x",l.layout.width-l.layout.padding).attr("y",0).attr("class","swap-icon").on("mousedown",m).append("xhtml:body").html("<i class='fa fa-tasks'></i>"),x.call(y),x}();!function(){var a=c.append("svg:defs");for(var b in l.data.legend){var d=l.data.legend[b],e=a.append("svg:linearGradient").attr("id","gradient-"+d.name).attr("x1","50%").attr("y1","0%").attr("x2","50%").attr("y2","100%");e.append("svg:stop").attr("offset","1%").attr("stop-color","#fff"),e.append("svg:stop").attr("offset","100%").attr("stop-color",d.color)}}();var d=c.selectAll(".layer").data(s).enter().append("g").attr("class","layer").style("fill",function(a,b){return l.isGradient?"url(#gradient-"+l.data.legend[b].name+")":l.data.legend[b].color}),e=d.selectAll("rect").data(function(a){return a});u=function(){return e.enter().append("rect").attr("class","bar").on("mouseover",y.show).on("mouseout",y.hide).on("mousedown",function(a){console.debug(a.parent+" "+a.dispValue)}).style("stroke","#000").style("stroke-width","1px")}(),v=function(){var a=e.enter().append("text").text(function(a){return 0!==a.dispValue&&l.display.labels.bars.show?l.display.labels.bars.formatting.strFormat.split("%n").join(l.display.labels.bars.formatting.numFormat(a.dispValue)):""}).attr("class",function(a){return"rectInner "+a.id}).style("pointer-events","none").style("font-family",l.display.labels.bars.font.face).style("font-size",l.display.labels.bars.font.size).style("font-weight",l.display.labels.bars.font.weight).style("font-style",l.display.labels.bars.font.style).style("fill","#000");return a.each(function(){var a=d3.select(this),b=this.getBBox().width,c=this.getBBox().height;a.attr("x",function(d){return d.compLen=b,d.compHeight=c,a.attr("x")})}),a}(),l.display.labels.aggregate.show&&(w=function(){var a=p();d3.range(k).map(function(b,c){x.append("text").text(a[c].dispValue).attr("class","rectInner aggregate").style("font-family",l.display.labels.bars.font.face).style("font-size",l.display.labels.bars.font.size).style("font-weight",l.display.labels.bars.font.weight).style("font-style",l.display.labels.bars.font.style).style("fill","#000")});var b=x.selectAll(".aggregate");return b.each(function(b,c){d3.select(this);var d=this.getBBox().width,e=this.getBBox().height;a[c].compLen=d,a[c].compHeight=e}),b}()),!function(){var b=function(a){var b=a?13:0;switch(l.layout.legend.compass){case"right":return function(){return l.layout.width+l.layout.margin.right+b};case"left":return function(){return l.layout.width+l.layout.margin.left+b};case"bottom":case"top":return function(a,c){return 30*c+b}}},d=function(a){var b=a?8:0;switch(l.layout.legend.compass){case"right":case"left":return function(a,c){return 20*c+b};case"bottom":case"top":return function(){return l.layout.height+b}}},e=c.append("g").attr("class","legend").attr("height",l.layout.legend.height).attr("width",l.layout.legend.width);e.selectAll("rect").data(l.data.legend).enter().append("rect").attr("x",b()).attr("y",d()).attr("width",10).attr("height",10).on("mousedown",function(a){console.debug(a)}).style("fill",function(a){return a.color}),e.selectAll("text").data(l.data.legend).enter().append("text").attr("x",b(!0)).attr("y",d(!0)).style("font-family",l.display.labels.legend.font.face).style("font-size",l.display.labels.legend.font.size).style("font-weight",l.display.labels.legend.font.weight).style("font-style",l.display.labels.legend.font.style).text(function(a){return a.name});var f=0,g=0;e.each(function(){f++;var a=this.getBBox().width;a>g&&(g=a);var b=d3.select(this);b.attr("x",parseInt(b.attr("x"))+10)}),l.layout.legend.width=g*f;var h=a();return e.attr("transform","translate("+(h.x-h.offsetX)+","+(h.y-h.offsetY)+")"),e}()};var A=function(){x.selectAll(".y.axis .tick text").text(function(a){return l.data.graph[a].name}).attr("transform","rotate(-90)").each(function(){var a=d3.select(this),b=this.getBBox().width;a.attr("x",parseInt(a.attr("x"))+b/2)}),x.selectAll(".axis .tick text").style("font-family",l.display.labels.bars.font.face).style("font-size",l.display.labels.bars.font.size).style("font-weight",l.display.labels.bars.font.weight).style("font-style",l.display.labels.bars.font.style),x.selectAll(".grid .tick text").style("display","none"),x.selectAll(".label").each(function(){var a=d3.select(this);if("true"!==a.attr("data-centered")){var b=this.getBBox().width,c=parseInt(a.attr("x"))+b/2;a.attr("x",c),a.attr("data-centered","true")}})};l.groupTransition=function(a){l.layout.graph.style="group";var b=z();u.transition().duration(a?0:500).delay(function(b,c){return a?0:10*c}).attr("x",function(){return 0}).attr("width",function(a){return h(a.y)}).transition().duration(a?0:250).attr("y",function(a,b,c){return i(a.x)+i.rangeBand()/j*c}).attr("height",function(){return(l.layout.graph.bars.maxWidth?l.layout.graph.bars.maxWidth:i.rangeBand()/j)-l.layout.graph.bars.spacing/2}).each("end",function(a){var b=d3.select(this),c=x.select("."+a.id),d=b.attr("width");l.display.labels.bars.hideSmallValueLabels&&d<=a.compLen?c.style("visibility","hidden"):c.style("visibility","visible")}),v.transition().duration(a?0:500).delay(function(b,c){return a?0:10*c}).attr("x",b.x).transition().duration(a?0:250).attr("y",b.y),l.display.labels.aggregate.show&&w.transition().duration(a?0:500).delay(function(b,c){return a?0:10*c}).attr("opacity",0)},l.stackTransition=function(a){l.layout.graph.style="stack";var b=z();if(u.transition().duration(a?0:500).delay(function(b,c){return a?0:10*c}).attr("y",function(a){return i(a.x)}).attr("height",function(){return l.layout.graph.bars.maxWidth?l.layout.graph.bars.maxWidth:i.rangeBand()}).transition().duration(a?0:250).attr("x",function(a){return h(a.y0)}).attr("width",function(a){return h(a.y)}).each("end",function(a){var b=d3.select(this),c=x.select("."+a.id),d=b.attr("width");l.display.labels.bars.hideSmallValueLabels&&d<=a.compLen?c.style("visibility","hidden"):c.style("visibility","visible")}),v.transition().duration(a?0:500).delay(function(b,c){return a?0:10*c}).attr("y",b.y).transition().duration(a?0:250).attr("x",b.x),l.display.labels.aggregate.show){var c=p();w.transition().duration(a?0:500).delay(function(b,c){return a?0:10*c}).attr("opacity",1).attr("x",function(a,d,e){return b.x(c[d],d,e)+1+c[d].compLen/2}).transition().duration(a?0:250).attr("y",function(a,d,e){return b.y(c[d],d,e)})}},l.redraw(),A(),function(){switch(l.layout.graph.style){case"group":return l.groupTransition(!0),void 0;case"stack":return l.stackTransition(!0),void 0;default:console.error("invalid layout style "+l.layout.graph.style)}}()};HorizontalBarGraph.prototype.defaults={formatting:{numFormat:"",strFormat:"%n",formatter:function(a){return a}},font:{align:"center",face:"sans-serif",weight:"normal",style:"normal",size:"10px"},display:{labels:{aggregate:{show:!1,formatting:void 0,font:void 0},bars:{formatting:void 0,font:void 0,show:!0,swap:!1,hideSmallValueLabels:!0,hideThreshold:0,gradient:!1},x:{formatting:void 0,font:void 0,text:""},y:{formatting:void 0,font:void 0,text:""},tooltip:{formatting:void 0},axes:{formatting:void 0,font:void 0},legend:{formatting:void 0,font:void 0}},grid:{lines:"vertical",tickPadding:7,tickCount:10},target:"body"},layout:{margin:{top:20,bottom:40,left:50,right:55},padding:30,width:960,height:500,graph:{style:"group",type:"value",bars:{direction:"vertical",spacing:0,maxWidth:null}},legend:{width:100,height:100,compass:"right"}},data:{graph:void 0,legend:void 0}},HorizontalBarGraph.prototype.merge=function(a,b){var c=JSON.parse(JSON.stringify(a));for(var d in a)b.hasOwnProperty(d)&&(c[d]="object"==typeof a[d]?this.merge(a[d],b[d]):b[d]);return c},HorizontalBarGraph.prototype.currentItem=0;
//# sourceMappingURL=dist/production/d3ca.map.js